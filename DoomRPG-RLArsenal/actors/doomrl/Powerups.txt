actor InvulnerabilitySphere2 : CustomInventory Replaces DRPGInvulnerabilitySphere
{
	Tag "Invulnerability Sphere - Invulnerability for 30 seconds"
	
	+INVBAR
	+INVENTORY.ADDITIVETIME
	+INVENTORY.PERSISTENTPOWER
    
	Inventory.DefMaxAmount
	Inventory.InterHubAmount 1000
	Inventory.PickupMessage "$GOTINVUL"
	Inventory.PickupSound "powerups/protect"
	Inventory.UseSound "powerups/protect"
	Inventory.Icon "PINV"
    
    States
	{
    Spawn:
        PINV ABCD 6 Bright
        Loop
	Pickup:
		TNT1 A 0 ACS_NamedExecuteWithResult("CheckCapacity")
		Stop
	Use:
		TNT1 A 1 A_TakeInventory ("PowerRLLavaSetBonusInvulnerable")
		TNT1 A 1 A_TakeInventory ("PowerInvulnerable")
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLInvulnerabilitySphereNormal2")
		stop
		TNT1 A 0 A_GiveInventory ("RLInvulnerabilitySphereMarine2")
		stop
	}
}

ACTOR RLInvulnerabilitySphereNormal2 : PowerupGiver Replaces RLInvulnerabilitySphereNormal
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Color GoldMap
	Powerup.Type Invulnerable
	Powerup.Duration -30
}

ACTOR RLInvulnerabilitySphereMarine2 : RLInvulnerabilitySphereNormal2 Replaces RLInvulnerabilitySphereMarine
{
	Powerup.Duration -45
}

actor InvulnerabilityCharge2 : DRPGInvulnerabilityCharge Replaces DRPGInvulnerabilityCharge
{
	States
	{
	Use:
		TNT1 A 1 A_TakeInventory ("PowerRLLavaSetBonusInvulnerable")
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLInvulnerabilityChargeNormal")
		stop
		TNT1 A 0 A_GiveInventory ("RLInvulnerabilityChargeMarine")
		stop
	} 
} 

ACTOR RLInvulnerabilityChargeNormal : PowerupGiver
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Color GoldMap
	Powerup.Type Invulnerable
	Powerup.Mode Reflective
	Powerup.Duration -30
}

ACTOR RLInvulnerabilityChargeMarine : RLInvulnerabilityChargeNormal
{
	Powerup.Duration -45
}

ACTOR BlurSphere2 : CustomInventory Replaces DRPGBlurSphere
{
	Tag "Blur Sphere - Partial Invisibility for 60 seconds"
	
	+INVBAR
	+INVENTORY.ADDITIVETIME
	+INVENTORY.PERSISTENTPOWER
	+VISIBILITYPULSE
	+FLOATBOB

	Inventory.DefMaxAmount
	Inventory.InterHubAmount 1000
	Inventory.PickupMessage "You got an Invisibility Sphere!"
	Inventory.PickupSound "powerups/invis"
	Inventory.UseSound "powerups/invis"
	Inventory.Icon "PINS"

	RenderStyle Translucent
	
    States
	{
    Spawn:
        PINS ABCD 6 Bright
        Loop
	Pickup:
		TNT1 A 0 ACS_NamedExecuteWithResult("CheckCapacity")
		Stop
	Use:
		TNT1 A 1 A_TakeInventory ("PowerRLLavaSetBonusInvulnerable")
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLBlurSphereNormal")
		stop
		TNT1 A 0 A_GiveInventory ("RLBlurSphereMarine")
		stop
	}
}	

ACTOR RLBlurSphereNormal : PowerupGiver
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Type Invisibility
	Powerup.Duration -60
}

ACTOR RLBlurSphereMarine : RLBlurSphereNormal
{
	Powerup.Duration -90
}

actor InvisibilityCharge2 : DRPGInvisibilityCharge Replaces DRPGInvisibilityCharge
{
	States
	{
	Use:
		TNT1 A 1 A_TakeInventory ("PowerRLLavaSetBonusInvulnerable")
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLInvisibilityChargeNormal")
		stop
		TNT1 A 0 A_GiveInventory ("RLInvisibilityChargeMarine")
		stop
	}
} 

ACTOR RLInvisibilityChargeNormal : PowerupGiver
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Type Shadow
	Powerup.Strength 100
	Powerup.Duration -30
}

ACTOR RLInvisibilityChargeMarine : RLInvisibilityChargeNormal
{
	Powerup.Duration -45
}

actor RadSuit2 : CustomInventory Replaces DRPGRadSuit
{
	Tag "Radiation Suit - Protects against Damage Floors"

	+INVBAR
	+INVENTORY.ADDITIVETIME
	+INVENTORY.PERSISTENTPOWER
	
	Inventory.DefMaxAmount
	Inventory.InterHubAmount 1000
	Inventory.PickupMessage "You got a Radiation Suit!"
	Inventory.PickupSound "powerups/suit"
	Inventory.UseSound "powerups/suit"
	Inventory.Icon "SUIT"
	
    States
	{
    Spawn:
        SUIT A -1 Bright
        Stop
	Pickup:
		TNT1 A 0 ACS_NamedExecuteWithResult("CheckCapacity")
		Stop
	Use:
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLRadSuitNormal2")
		stop
		TNT1 A 0 A_GiveInventory ("RLRadSuitMarine2")
		stop
	}
}

ACTOR RLRadSuitNormal2 : PowerupGiver
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Type IronFeet
	Powerup.Duration -60
}

ACTOR RLRadSuitMarine2 : RLRadSuitNormal2
{
	Powerup.Duration -90
}

actor Infrared2 : CustomInventory Replaces DRPGInfrared
{
	Tag "Night-Vision Goggles - See in the Dark"
	
	+INVBAR
	+INVENTORY.ADDITIVETIME
	+INVENTORY.PERSISTENTPOWER
	
	Inventory.DefMaxAmount
	Inventory.InterHubAmount 1000
	Inventory.PickupMessage "You got a pair of Infrared Goggles!"
	Inventory.PickupSound "powerups/light"
	Inventory.UseSound "powerups/light"	
	Inventory.Icon "PVIS"
	
	States
	{
    Spawn:
        PVIS AB 6 Bright
        Loop
	Pickup:
		TNT1 A 0 ACS_NamedExecuteWithResult("CheckCapacity")
		Stop
	Use:
		TNT1 A 0 A_JumpIfInventory ("RLAmmochainPerk", 1, 2)
		TNT1 A 1 A_GiveInventory ("RLInfraredNormal2")
		stop
		TNT1 A 0 A_GiveInventory ("RLInfraredMarine2")
		stop
	}
}

ACTOR RLInfraredNormal2 : PowerupGiver
{
	+INVENTORY.AUTOACTIVATE
	+INVENTORY.ADDITIVETIME
	
	Powerup.Type LightAmp
	Powerup.Duration -120
}

ACTOR RLInfraredMarine2 : RLInfraredNormal2
{
	Powerup.Duration -180
}

actor Berserk2 : CustomInventory Replaces DRPGBerserk
{
	Tag "Berserk Pack - +100 HP and Increased Melee Damage"
	
	+INVBAR
	-INVENTORY.AUTOACTIVATE
	-INVENTORY.ALWAYSPICKUP
	
	Inventory.DefMaxAmount
	Inventory.InterHubAmount 1000
	Inventory.PickupMessage "You got a Berserk Pack!"
	Inventory.PickupSound "powerups/berserk"
	Inventory.UseSound "powerups/berserk"
	Inventory.Icon "PSTR"
	
    States
    {
    Spawn:
        PSTR A -1
        Stop
	Pickup:
		TNT1 A 0 ACS_NamedExecuteWithResult("CheckCapacity")
		Stop
    Pickup:
		TNT1 A 0 A_JumpIfInventory("PowerStrength", 1, 7)
		TNT1 A 0 A_JumpIfInventory("RLMedicalArmorToken", 1, 6)
		TNT1 A 0 A_JumpIfInventory("RLMedicalPowerArmorToken", 1, 5)
		TNT1 A 0 A_JumpIfInventory("RLOModMedicalArmorToken", 1, 4)
		TNT1 A 0 A_JumpIfInventory("RLSurvivalMediArmorToken", 1, 3)
		TNT1 A 0 A_JumpIfInventory("RLOModSurvivalMediArmorToken", 1, 2)
		TNT1 A 0 ACS_NamedExecuteAlways("AddToxicity", 0, 10)
        TNT1 A 0 A_JumpIfInventory ("RLBerserkPowersuitArmorToken", 1, "Powersuit")
        TNT1 A 0 A_GiveInventory("PowerStrength")
        TNT1 A 0 A_JumpIfInventory ("RLAmmoChainPerk", 1, 2)
        TNT1 A 0 A_GiveInventory("PowerBerserkResistance")
        Goto Pickup+12
        TNT1 A 0 A_GiveInventory("PowerBerserkResistanceMarine")
        TNT1 A 0 HealThing(100, 0)
        Stop
    Powersuit:
        TNT1 A 0 A_GiveInventory("RLBerserkPowersuitBerserkCounter", 1)
        Stop
    }
}

actor Megasphere2 : DRPGMegasphere Replaces DRPGMegasphere
{
	States
	{
	Pickup:
		TNT1 A 0 A_GiveInventory("SoulSphere", Random(1, 3))
		TNT1 A 0 ACS_NamedExecuteAlways("AddEP", 0, 1000000)
		TNT1 A 0 ACS_NamedExecuteAlways("AddShield", 0, 1000000)
		TNT1 A 0 A_JumpIfInventory ("RLIndestructibleArmorWorn", 1, "NoRepair")
		TNT1 A 0 A_JumpIfInventory ("BasicArmor", 1, 2)
		Stop
	NoRepair:
        TNT1 A 0 A_JumpIfInventory ("RLDemonicSetBonusActive", 1, "DemonicCharge")
		Stop
		TNT1 A 0 A_JumpIfInventory ("RL100ArmorWorn", 1, "100Armor")
		TNT1 A 0 A_JumpIfInventory ("RL150ArmorWorn", 1, "150Armor")
		TNT1 A 0 A_JumpIfInventory ("RL200ArmorWorn", 1, "200Armor")
		TNT1 A 0 A_JumpIfInventory ("RL100RegenArmorWorn", 1, "100Armor")
        stop
	100Armor:
		TNT1 A 0 A_GiveInventory("RLArmorBonus100Megasphere", 1)
    TNT1 A 0 A_JumpIfInventory ("RLDemonicSetBonusActive", 1, "DemonicCharge")
		Stop
	150Armor:
		TNT1 A 0 A_GiveInventory("RLArmorBonus150Megasphere", 1)
    TNT1 A 0 A_JumpIfInventory ("RLDemonicSetBonusActive", 1, "DemonicCharge")
		Stop
	200Armor:
		TNT1 A 0 A_GiveInventory("RLArmorBonus200Megasphere", 1)
    TNT1 A 0 A_JumpIfInventory ("RLDemonicSetBonusActive", 1, "DemonicCharge")
		Stop
    DemonicCharge:
        TNT1 A 0 A_GiveInventory ("RLDemonicCarapaceSupercharge", 1)
        TNT1 A 0 A_Print("Demonic Carapace supercharged!")
        TNT1 A 0
        Stop
	}
}

ACTOR PowerRLLavaSetBonusInvulnerable2 : PowerInvulnerable Replaces PowerRLLavaSetBonusInvulnerable
{
	Powerup.Duration -9
	inventory.icon ""
	Powerup.Color GoldMap
}

// Immunity Crystal
actor DRPGImmunityCrystal : CustomInventory
{
    Inventory.Amount 1
    Inventory.MaxAmount 1
	Inventory.PickupMessage "Got an Immunity Crystal!"
	Inventory.PickupSound "powerups/crystal"
	Inventory.Icon "CRYS"
    
    +INVBAR
    +FLOATBOB
    +BRIGHT
    
    RenderStyle Add
    
    Tag "Immunity Crystal"
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay A_Jump(256, "BulletMode", "MeleeMode", "FireMode", "PlasmaMode")
    BulletMode:
        CRYS AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 35 A_RadiusGive("DRPGPowerImmunityBullet", 512.0, RGF_PLAYERS)
        TNT1 A 0 A_Jump(240, "MeleeMode", "FireMode", "PlasmaMode")
        Goto BulletMode
    MeleeMode:
        CRYS BBBBBBBBBBBBBBBBBBBBBBBBBBBBBB 35 A_RadiusGive("DRPGPowerImmunityMelee", 512.0, RGF_PLAYERS)
        TNT1 A 0 A_Jump(240, "BulletMode", "FireMode", "PlasmaMode")
        Goto MeleeMode
    FireMode:
        CRYS CCCCCCCCCCCCCCCCCCCCCCCCCCCCCC 35 A_RadiusGive("DRPGPowerImmunityFire", 512.0, RGF_PLAYERS)
        TNT1 A 0 A_Jump(240, "MeleeMode", "BulletMode", "PlasmaMode")
        Goto FireMode
    PlasmaMode:
        CRYS DDDDDDDDDDDDDDDDDDDDDDDDDDDDDD 35 A_RadiusGive("DRPGPowerImmunityPlasma", 512.0, RGF_PLAYERS)
        TNT1 A 0 A_Jump(240, "MeleeMode", "FireMode", "BulletMode")
        Goto PlasmaMode
    Use:
        TNT1 A 0 A_FireCustomMissile("DRPGImmunityCrystalDropped", 0, 0, 0)
        Stop
    }
}

actor DRPGImmunityCrystalDropped
{
    Damage 0
    Radius 16
    Height 8
    Speed 10
    
    Projectile
    +BRIGHT
    -NOGRAVITY
    
    States
    {
    Spawn:
        CRYS ABCD 1
        Loop
    Death:
        CRYS A 1 A_SpawnItem("DRPGImmunityCrystal", 0, 0, 0, 0)
        Stop
    }
}

actor DRPGPowerImmunityBullet : PowerProtection
{
    +INVENTORY.AUTOACTIVATE
    
    DamageFactor "Bullet", 0
	Powerup.Duration 35
}

actor DRPGPowerImmunityMelee : PowerProtection
{
    +INVENTORY.AUTOACTIVATE
    
    DamageFactor "Melee", 0
	Powerup.Duration 35
}

actor DRPGPowerImmunityFire : PowerProtection
{
    +INVENTORY.AUTOACTIVATE
    
    DamageFactor "Fire", 0
	Powerup.Duration 35
}

actor DRPGPowerImmunityPlasma : PowerProtection
{
    +INVENTORY.AUTOACTIVATE
    
    DamageFactor "Plasma", 0
	Powerup.Duration 35
}
