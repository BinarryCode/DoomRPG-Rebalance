// Map Event - Termonuclear Bomb
// --------------------------------------------------

actor DRPGThermonuclearBomb : SwitchableDecoration
{
    var int user_disarmed;
    
    Health 50
    Radius 16
    Height 32
    Mass 50
    
    Scale 0.75
    
    +SOLID
    -SHOOTABLE
    +NOBLOOD
    +DONTBLAST
    +DONTDRAIN
    +PUSHABLE
    -USESPECIAL
    
    Activation THINGSPEC_ThingTargets | THINGSPEC_Activate | THINGSPEC_Switch
    
    States
    {
    Spawn:
        TNT1 A 0 A_PlaySound("nuke/idle", CHAN_6, 1.0, true, ATTN_NORM)
        TBOM AB 6 Bright
        Loop
    SpawnActive:
        TNT1 A 0 A_ChangeFlag("SHOOTABLE", true)
        TNT1 A 0 A_ChangeFlag("USESPECIAL", true)
        TNT1 A 0 A_PlaySound("nuke/idle", CHAN_6, 1.0, true, ATTN_NORM)
        TBOM AB 6 Bright
        Loop
    Inactive:
    Active:
        TNT1 A 0 A_JumpIf(user_disarmed, "Disarmed")
        TNT1 A 0 A_PlaySound("nuke/use", CHAN_5, 1.0, false, ATTN_NORM)
        TNT1 A 0 ACS_NamedExecuteAlways("ThermonuclearBombActivate", 0)
        Goto SpawnActive
    Disarmed:
        TNT1 A 0 A_StopSound(CHAN_6)
        TNT1 A 0 A_ChangeFlag("SHOOTABLE", false)
        TBOM C -1
        Stop
    Death:
    Explode:
        TNT1 A 0 ACS_NamedExecuteAlways("ThermonuclearBombExplode", 0)
        TNT1 A 0 A_StopSound(CHAN_6)
        MISL BCD 6 Bright
        Stop
    }
}

actor DRPGNukeKey : Inventory
{
    Inventory.Amount 1
    Inventory.MaxAmount 1
    Inventory.PickupMessage "You got a Thermonuclear Bomb key."
    Inventory.PickupSound "arena/keydrop"
    
    Scale 0.5
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        TNT1 A 0
        Stop
    }
}

actor DRPGNukeKey1 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY A 6
        NKEY A 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey2 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY B 6
        NKEY B 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey3 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY C 6
        NKEY C 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey4 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY D 6
        NKEY D 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey5 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY E 6
        NKEY E 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey6 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY F 6
        NKEY F 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey7 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY G 6
        NKEY G 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey8 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY H 6
        NKEY H 6 Bright
        Goto Spawn+1
    }
}

actor DRPGNukeKey9 : DRPGNukeKey
{
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        NKEY I 6
        NKEY I 6 Bright
        Goto Spawn+1
    }
}

// Map Event - Low Power
// --------------------------------------------------

actor DRPGGenerator : SwitchableDecoration
{
    var int user_powered;
    
    Radius 24
    Height 80
    
    Scale 0.5
    
    -SOLID
    +USESPECIAL
    
    Activation THINGSPEC_ThingTargets | THINGSPEC_Activate | THINGSPEC_Switch
    
    States
    {
    Spawn:
    Inactive:
    Active:
        TNT1 A 0 A_JumpIf(user_powered, "PoweredUp")
        TNT1 A 0 ACS_NamedExecuteAlways("PowerGeneratorActivate", 0)
        GENR B -1
        Stop
    PoweredUp:
        GENR A 1 Bright
        Loop
    }
}

actor DRPGGeneratorCell : Inventory
{
    Scale 0.5
    
    -INVBAR
    
    Inventory.Amount 1
    Inventory.MaxAmount 1
    Inventory.PickupMessage "You got a Generator Power Cell."
    Inventory.PickupSound "items/vial"
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
    SpawnLoop:
        GCEL ABCDEFGFEDCB 6 Bright
        Loop
    }
}

actor DRPGGeneratorCellDead : Inventory
{
    Scale 0.5
    
    -INVBAR
    
    Inventory.DefMaxAmount
    Inventory.InterHubAmount 1000
    Inventory.PickupMessage "You got a dead Generator Power Cell."
    Inventory.PickupSound "items/vial"
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        GCEL H -1
        Stop
    }
}

// Map Event - Hell Unleashed
// --------------------------------------------------

actor DRPGPandoraBox : SwitchableDecoration
{
    Radius 16
    
    -SOLID
    +USESPECIAL
    
    Activation THINGSPEC_Activate
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay A_SetTranslucent(0.0)
        PBOX A 1 Bright
        TNT1 A 0 A_FadeIn(0.01, FTF_CLAMP)
        TNT1 A 0 A_SpawnItemEx("DRPGBlingParticle", Random(-Radius, Radius), Random(-Radius, Radius), Random(-Height + 16, Height + 16))
        TNT1 A 0 A_Jump(Alpha >= 1.0, "Spawn2")
        Goto Spawn+1
    Spawn2:
        PBOX A -1 Bright
        Stop
    Active:
        TNT1 A 0 A_SetTranslucent(1.0)
        TNT1 A 0 A_PlaySound("pandorabox/whoosh", CHAN_BODY, 1.0, false, ATTN_NORM)
        PBOX BCDEFG 6 Bright
        TNT1 A 0 A_PlaySound("pandorabox/open1", CHAN_5, 1.0, false, ATTN_NORM)
        PBOX HI 6 Bright
        TNT1 A 0 A_PlaySound("pandorabox/open2", CHAN_7, 1.0, false, ATTN_NORM)
        PBOX JKL 6 Bright
        PBOX L 15 Bright
        TNT1 A 0 ACS_NamedExecuteAlways("HellUnleashedStart", 0)
        PBOX R 280 Bright A_PlaySound("pandorabox/doom", CHAN_5, 1.0, false, ATTN_NONE)
        TNT1 A 0 A_PlaySound("pandorabox/loop", CHAN_6, 1.0, true, 2.0)
    ActiveLoop:
        PBOX MNOPQPON 4 Bright
        Loop
    }
}

// Map Event - Environmental Hazard
// --------------------------------------------------

actor DRPGRadiationNeutralizer : SwitchableDecoration
{
    Radius 34
    Height 40
    
    -SOLID
    +USESPECIAL
    
    Activation THINGSPEC_ThingTargets | THINGSPEC_Activate | THINGSPEC_Switch
    
    States
    {
    Spawn:
        RADM A -1
        Stop
    Inactive:
    Active:
        TNT1 A 0 ACS_NamedExecuteWithResult("EnvironmentalHazardRefillGenerator")
        Goto Spawn
    }
}

actor DRPGNeutralizerFuel : Inventory
{
    -INVBAR
    
    Inventory.Amount 1
    Inventory.MaxAmount 5
    Inventory.PickupMessage "You got a Radiation Neutralizer fuel tank."
    Inventory.PickupSound "radiation/tankup"
    
    States
    {
    Spawn:
        TNT1 A 0 NoDelay ACS_NamedExecuteAlways("ItemInit", 0)
        RADM B -1
        Stop
    }
}

// UB0R H4X 2 MAEK UR DOLLZ NOT 2DIE FR0M RAD1AT10N
Actor AntiRadiationForMyVoodooDolls : CustomInventory
{
    Inventory.MaxAmount 0
    
    +INVENTORY.AUTOACTIVATE
    
    States
    {
    Pickup:
        TNT1 A 0 A_RadiusGive("VoodooDollAntiRadiation", 16383, RGF_VOODOO | RGF_CUBE | RGF_NOSIGHT)
        Stop
    }
}

Actor VoodooDollAntiRadiation : CustomInventory
{
    Inventory.MaxAmount 0
    
    +INVENTORY.AUTOACTIVATE
    
    States
    {
    Pickup:
        TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0) // Epic Megahacks - Because literally nothing else would work.â„¢
        Stop
    }
}
